{% extends "base.html" %}

{% block title %}Kamatera — Détails du Serveur{% endblock %}

{% block header %}
<a href="/" class="inline-flex items-center text-blue-600 hover:text-blue-800 mb-4">
  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
  </svg>
  Retour à la liste
</a>
<h2 class="text-3xl font-bold text-gray-900">Détails du Serveur</h2>
{% endblock %}

{% block content %}
<!-- Loading indicator -->
<div id="loading" class="text-center py-12">
  <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
  <p class="mt-4 text-gray-600">Chargement des détails du serveur…</p>
</div>

<!-- Server details container -->
<div id="server-details" class="hidden">
  <!-- Server header card -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-start">
      <div>
        <h2 id="server-name" class="text-2xl font-bold text-gray-900">Chargement...</h2>
        <p id="server-id" class="text-sm text-gray-500 mt-1"></p>
      </div>
      <span id="server-status" class="px-4 py-2 rounded-full text-sm font-medium"></span>
    </div>
  </div>

  <!-- Action buttons -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Actions</h3>
    <div class="flex flex-wrap gap-3">
      <button 
        onclick="startServer()"
        class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-6 rounded transition-colors">
        Démarrer
      </button>
      <button 
        onclick="stopServer()"
        class="bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-6 rounded transition-colors">
        Arrêter
      </button>
      <button 
        onclick="rebootServer()"
        class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-6 rounded transition-colors">
        Redémarrer
      </button>
      <button 
        onclick="renameServer()"
        class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-6 rounded transition-colors">
        Renommer
      </button>
      <button 
        onclick="cloneServer()"
        class="bg-purple-500 hover:bg-purple-600 text-white font-medium py-2 px-6 rounded transition-colors">
        Clone
      </button>
      <button 
        onclick="destroyServer()"
        class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-6 rounded transition-colors">
        Détruire
      </button>
    </div>
  </div>

  <!-- Server information -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-6">Informations du Serveur</h3>
    <div id="server-info" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Will be populated dynamically -->
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/control.js"></script>
<script src="/static/js/render.js"></script>
<script src="/static/js/fetcher.js"></script>
<script>
  // Global variable to store server data
  let serverData = null;
  // Store server_id passed from backend via Jinja2
  const SERVER_ID = "{{ server_id }}";

  /**
   * Get server ID from template context (set by backend)
   */
  function getServerIdFromUrl() {
    return SERVER_ID || globalThis.location.pathname.split('/').pop();
  }

  /**
   * Remove loading indicator and show details
   */
  function showServerDetails() {
    document.getElementById('loading')?.classList.add('hidden');
    document.getElementById('server-details')?.classList.remove('hidden');
  }

  // Load server details on page load
  globalThis.addEventListener('DOMContentLoaded', fetchServerDetails);
</script>
{% endblock %}
